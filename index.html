<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Hangul - JC Edition</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f8fafc; }
        body { font-family: sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; width: 90%; max-width: 500px; padding: 2rem; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        h1 { font-size: 1.5rem; text-align: center; color: #1e293b; }
        textarea { width: 100%; height: 180px; padding: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1.2rem; box-sizing: border-box; outline: none; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 1rem; }
        button { padding: 0.8rem; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-copy { background: var(--primary); color: white; }
        .btn-reset { background: #e2e8f0; color: #475569; }
    </style>
</head>
<body>

<div class="container">
    <h1>Quick Hangul by JC</h1>
    <textarea id="input" placeholder="영문 자판으로 입력..." 
              autocomplete="off" autocapitalize="off" spellcheck="false" 
              inputmode="url"></textarea> 
    
    <div class="btn-group">
        <button class="btn-reset" onclick="resetText()">지우기</button>
        <button class="btn-copy" onclick="copyText()">복사하기</button>
    </div>
    <p style="font-size: 0.8rem; color: #94a3b8; text-align: center; margin-top: 20px;">
        킨들/모바일은 여기서 입력 후 복사하세요.
    </p>
</div>

<script>
    const m={'q':'ㅂ','Q':'ㅃ','w':'ㅈ','W':'ㅉ','e':'ㄷ','E':'ㄸ','r':'ㄱ','R':'ㄲ','t':'ㅅ','T':'ㅆ','y':'ㅛ','u':'ㅕ','i':'ㅑ','o':'ㅐ','O':'ㅒ','p':'ㅔ','P':'ㅖ','a':'ㅁ','s':'ㄴ','d':'ㅇ','f':'ㄹ','g':'ㅎ','h':'ㅗ','j':'ㅓ','k':'ㅏ','l':'ㅣ','z':'ㅋ','x':'ㅌ','c':'ㅊ','v':'ㅍ','b':'ㅠ','n':'ㅜ','m':'ㅡ'};
    const S_C=[0,1,3,6,7,8,16,17,18,20,21,22,23,24,25,26,27,28,29], S_J=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15,16,17,18,20,22,27], S_B=[0,1,2,3,4,5,6,8,9,10,11,12,13,14,15,16,17,19,20,21,22,23,24,25,26,27,28,29];
    const K_C='ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ', K_J='ㅏㅐㅑㅒㅓㅔㅕㅖㅗㅘㅙㅚㅛㅜㅝㅞㅟㅠㅡㅢㅣ', K_B=' ㄱㄲㄳㄴㄵㄶㄷㄹㄺㄻㄼㄽㄾㄿㅀㅁㅂㅄㅅㅆㅇㅈㅊㅋㅌㅍㅎ';

    let charList = [];
    const inputArea = document.getElementById('input');
    let isRendering = false;

    // 킨들 크롬의 모든 입력 시도를 감시
    inputArea.addEventListener('input', (e) => {
        if (isRendering) return; // 렌더링 중 발생하는 이벤트 무시

        const currentVal = inputArea.value;
        
        // 1. 글자가 지워졌을 때 (백스페이스)
        if (e.inputType === 'deleteContentBackward' || e.inputType === 'deleteContentForward') {
            charList.pop();
        } 
        // 2. 글자가 추가됐을 때
        else {
            // e.data가 없는 킨들 크롬을 위해 실제 벨류 차이로 계산
            const newChar = e.data || currentVal.slice(-1);
            if (newChar === " " || e.inputType === "insertLineBreak") {
                charList.push(newChar === " " ? " " : "\n");
            } else {
                const kor = m[newChar.toLowerCase()] || newChar;
                charList.push(kor);
            }
        }
        render();
    });

    function assem(chars){
        let res='', i=0;
        while(i<chars.length){
            let ci=K_C.indexOf(chars[i]), ni=K_J.indexOf(chars[i+1]);
            if(ci!==-1 && ni!==-1){
                let cho=S_C.indexOf(ci), jung=ni, jong=0; i+=2;
                let ti=K_B.indexOf(chars[i]), ui=K_J.indexOf(chars[i+1]);
                if(ti>0 && ui===-1){ jong=S_B.indexOf(ti); i++; }
                res+=String.fromCharCode(44032+(cho*21+jung)*28+jong);
            } else { res+=chars[i]; i++; }
        }
        return res;
    }

    function render() {
        isRendering = true; // 무한 루프 방지
        inputArea.value = assem(charList);
        inputArea.scrollTop = inputArea.scrollHeight;
        setTimeout(() => { isRendering = false; }, 10); 
    }

    function resetText() { charList = []; inputArea.value = ''; inputArea.focus(); }
    function copyText() {
        inputArea.select();
        document.execCommand('copy');
        alert('복사되었습니다!');
    }
</script>
</body>
</html>
